include("shared.lua") include("cl_animations.lua")  function ENT:Initialize()     self:DrawShadow(false)     self.AmbientSound = CreateSound(self, "npc/combine_gunship/engine_rotor_loop1.wav")     self.OriginalOwner = self:GetOwner()     self.OriginalOwner.SwordThrow = true     self.Ended = false end  function ENT:Think()     self.AmbientSound:PlayEx(85, 60) end  function ENT:OnRemove()     self.AmbientSound:Stop()      self.OriginalOwner.SwordThrow = false      self:RemoveModels() end  local matGlow2 = Material("sprites/glow04_noz") local matGlow = Material("effects/yellowflare") function ENT:Draw()     local pos, ang = self:GetPos(), self:GetAngles()      render.SetBlend(0)     self:DrawModel()     render.SetBlend(1)   local emitter = ParticleEmitter(pos)  emitter:SetNearClip(24, 32)  local particle  for i=0, 23 do  pos = pos + self:GetAngles():Right() * math.random(8, -8)   particle = emitter:Add(matGlow2, pos)  particle:SetVelocity(VectorRand() * 45)  particle:SetDieTime(0.1)  particle:SetStartAlpha(80)  particle:SetEndAlpha(0)  particle:SetStartSize(20)  particle:SetEndSize(0)  particle:SetRollDelta(math.Rand(-10, 10))  particle:SetColor(160, 100, 160)  end  for i=0, 2 do  pos = pos + self:GetAngles():Right() * math.random(3, -3)   particle = emitter:Add(matGlow, pos)  particle:SetVelocity(VectorRand() * 10)  particle:SetDieTime(0.4)  particle:SetStartAlpha(255)  particle:SetEndAlpha(0)  particle:SetStartSize(20)  particle:SetEndSize(0)  particle:SetRollDelta(math.Rand(-10, 10))  particle:SetColor(255, 100, 255)  end      if self:GetEnd() and not self.Ended then         for i=0, 20 do             particle = emitter:Add(matGlow, pos)             particle:SetVelocity(VectorRand() * 45)             particle:SetDieTime(0.55)             particle:SetStartAlpha(160)             particle:SetEndAlpha(0)             particle:SetStartSize(math.Rand(127, 129))             particle:SetEndSize(0)             particle:SetRoll(math.Rand(-0.8, 0.8))             particle:SetRollDelta(math.Rand(-3, 3))             particle:SetColor(230, 70, 230)         end       sound.Play("weapons/physcannon/energy_sing_explosion2.wav", pos, 80, 80)          self.Ended = true     end      emitter:Finish() emitter = nil collectgarbage("step", 64)          if not self.WElements then         local elems = weapons.Get("weapon_zs_undeadslayer_r0")          self.WElements = table.FullCopy(elems.WElements)         self:CreateModels(self.WElements)          return     end      if not self.WElements then return end      local w_ele = self.WElements["hilt"]     local model_ent = w_ele.modelEnt     if not model_ent then return end     self:RenderModels(1)      local unpredicted = UnPredictedCurTime()  local ang = Angle(0, unpredicted * 900, math.cos(unpredicted * 99) * 2)   self:SetRenderAngles(ang) end  