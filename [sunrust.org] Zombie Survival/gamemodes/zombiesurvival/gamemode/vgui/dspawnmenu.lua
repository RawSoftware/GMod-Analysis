local PANEL = {}  PANEL.Spacing = 12 PANEL.SlideTime = 0   PANEL.NextRefresh = 0 PANEL.RefreshTime = 1  function PANEL:Init()  self:RefreshSize()  self:SetPos(ScrW() - 1, 0)   self.Items = {} end  function PANEL:Think()  local time = RealTime()   if self.CloseTime and time >= self.CloseTime then  self.CloseTime = nil  self:SetVisible(false)  elseif self.StartChecking and time >= self.StartChecking then  if not MySelf:KeyDown(GAMEMODE.MenuKey) then  self:CloseMenu()  end  end end  function PANEL:RefreshSize()  self:SetSize(BetterScreenScale() * 320, ScrH()) end  function PANEL:OpenMenu()  if self.StartChecking and RealTime() < self.StartChecking then return end   self.CloseTime = nil   self:RefreshSize()  self:SetPos(ScrW() - self:GetWide(), 0, self.SlideTime, 0, self.SlideTime * 0.8)    self:SetVisible(true)  self:MakePopup()  self.StartChecking = RealTime() + 0.1  self:RefreshContents()   timer.Simple(0, function()  gui.SetMousePos(ScrW() * 0.5, ScrH() * 0.5)  end) end  function PANEL:CloseMenu()  self:RefreshContents()   if self.CloseTime then return end  self.CloseTime = RealTime() + self.SlideTime end  local texRightEdge = surface.GetTextureID("gui/gradient") function PANEL:Paint()  surface.SetDrawColor(5, 5, 5, 180)  surface.DrawRect(self:GetWide() * 0.4, 0, self:GetWide() * 0.6 + 1, self:GetTall())  surface.SetTexture(texRightEdge)  surface.DrawTexturedRectRotated(self:GetWide() * 0.2, self:GetTall() * 0.5, self:GetWide() * 0.4, self:GetTall(), 180) end  function PANEL:AddItem(item)  item:SetParent(self)  item:SetWide(self:GetWide() - 16)   table.insert(self.Items, item) end  function PANEL:RefreshContents()  for k, v in pairs(self.Items) do  v:Remove()  end  self.Items = {}   local occurs = {}  local screenscale = BetterScreenScale()     local sigils = GAMEMODE:GetUncorruptedSigils()     local ents_by_order = ents.FindByClass("prop_obj_sigil")   local function BuildNestInfo(nest, gas)  if not gas and (not nest:IsValid() or not nest.GetNestOwner) then return end   local ownname, nown = "Last Gas Spawn"  if not gas then  nown = nest:GetNestOwner()  occurs[nown] = (occurs[nown] or 0) + 1  ownname = nown:IsValidZombie() and nown:ClippedName() or ""  end   local combo_panel = vgui.Create("DPanel", self)   local icon_size = 44 * screenscale   local btn = vgui.Create("DButton", combo_panel)  btn:SetText("")  btn:SetSize(icon_size * 1.5, icon_size)  btn:Dock(LEFT)  local lock = vgui.Create("DImage", btn)   btn.DoClick = function()  if GAMEMODE.DesiredNest == nest then  GAMEMODE.DesiredNest = nil  else  GAMEMODE.DesiredNest = nest  end   if gas then  net.Start("zs_gaslock")  net.SendToServer()  else  net.Start("zs_nestlock")  net.WriteEntity(nest)  net.SendToServer()  end   self:RefreshContents()  end          if not gas then             local att_dist, att_sigil = GAMEMODE:NearestSigilDataToNest(nest, sigils)             if att_sigil then                 local letter = "?"                 for i, sigil in ipairs(ents_by_order) do                     if att_sigil == sigil then                         letter = string.char(64 + i)                         break                     end                 end                  local metres = math.Round(att_dist / 52.6, 2)                  local sigil_label = EasyLabel(combo_panel, "Attacking Sigil " .. letter .. " (" .. metres .. "m" .. ")", "ZSBodyTextFont", COLOR_WHITE)                 sigil_label:SizeToContents()                 sigil_label:Dock(BOTTOM)                 sigil_label:SetContentAlignment(5)             end         end   lock:SetImage("zombiesurvival/padlock.png")  lock:SetSize(icon_size, icon_size)  lock:CenterVertical(0.6)  lock:CenterHorizontal(0.5)  lock:SetImageColor(GAMEMODE.DesiredNest == nest and Color(255, 100, 100, 255) or Color(200, 200, 200, 150))   combo_panel:SizeToContentsX(10)   local final_text = not gas and ("Nest (" .. ownname .. " - " .. occurs[nown] .. ")") or ownname   local item = EasyButton(combo_panel, final_text, 8, 4)  item:SetFont("ZSHUDFontSmall")  item:SetContentAlignment(5)  item:SetWide(self:GetWide() * 0.7)  item:SetPos()  item:Dock(RIGHT)  item.DoClick = function()  if gas then  net.Start("zs_gasspec")  net.SendToServer()  else  net.Start("zs_nestspec")  net.WriteEntity(nest)  net.SendToServer()  end  end   combo_panel:SetTall(icon_size * 1.25)  combo_panel:SetPaintBackground(false)   self:AddItem(combo_panel)  end   for k, nest in ipairs(GAMEMODE.CachedNests) do  BuildNestInfo(nest)  end   for k, baby in ipairs(GAMEMODE.CachedBabies) do  if not baby:IsValid() then continue end   local item = EasyButton(self, "Gore Child", 8, 4)  item:SetFont("ZSHUDFontSmall")  item:SizeToContents()  item.DoClick = function()  net.Start("zs_nestspec")  net.WriteEntity(baby)  net.SendToServer()  end   self:AddItem(item)  end   if GAMEMODE.LastGasSpawn then  BuildNestInfo(GAMEMODE.LastGasSpawn, true)  end   self:InvalidateLayout() end  function PANEL:PerformLayout()  local y = ScrH() / 2  for k, item in ipairs(self.Items) do  if item and item:IsValid() and item:IsVisible() then  y = y - (item:GetTall() + self.Spacing) / 2  end  end   for k, item in ipairs(self.Items) do  if item and item:IsValid() and item:IsVisible() then  item:SetPos(0, y)  item:CenterHorizontal()  y = y + item:GetTall() + self.Spacing  end  end end  vgui.Register("DZombieSpawnMenu", PANEL, "DPanel") 